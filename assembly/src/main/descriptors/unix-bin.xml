<?xml version="1.0" encoding="UTF-8"?>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at
   
    http://www.apache.org/licenses/LICENSE-2.0
   
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<assembly>
    <id></id> <!-- intentionally left blank -> http://jira.codehaus.org/browse/MASSEMBLY-301 -->
    <formats>
        <format>tar.gz</format>
    </formats>
    <fileSets>

        <!-- Expanded ServiceMix Runtime -->
        <fileSet>
            <directory>target/dependencies/unix/apache-servicemix-kernel-${servicemix.kernel.version}</directory>
            <outputDirectory>/</outputDirectory>
            <excludes>
              <exclude>bin/*</exclude>
            </excludes>
        </fileSet>

        <!-- Copy over bin/servicemix separately to get the correct file mode -->
        <fileSet>
            <directory>target/dependencies/unix/apache-servicemix-kernel-${servicemix.kernel.version}</directory>
            <outputDirectory>/</outputDirectory>
            <includes>
              <include>bin/*</include>
            </includes>
            <fileMode>0755</fileMode>
        </fileSet>

        <!-- Copy license and other files from root -->
        <fileSet>
            <directory>..</directory>
            <outputDirectory>/</outputDirectory>
            <includes>
                <include>README.txt</include>
                <include>RELEASE*.txt</include>
            </includes>
            <lineEnding>unix</lineEnding>
        </fileSet>

        <!-- Copy over everything that needs to get unix line endings -->
        <fileSet>
            <directory>src/main/distribution/text</directory>
            <outputDirectory>/</outputDirectory>
            <lineEnding>unix</lineEnding>
        </fileSet>        
        <fileSet>
            <directory>src/main/distribution/unix-text</directory>
            <outputDirectory>/</outputDirectory>
            <lineEnding>unix</lineEnding>
        </fileSet>        
        <fileSet>
            <directory>target/classes/etc</directory>
            <outputDirectory>/etc/</outputDirectory>
            <lineEnding>unix</lineEnding>
        </fileSet>

        <!-- Copy over files that should not get the line endings converted -->
        <fileSet>
            <directory>src/main/distribution/binary</directory>
            <outputDirectory>/</outputDirectory>
        </fileSet>

        <!-- Copy over the files that should not get the line endings converted but need to be chmod to 755 -->
        <fileSet>
            <directory>src/main/distribution/unix-binary</directory>
            <outputDirectory>/</outputDirectory>
            <fileMode>0755</fileMode>
        </fileSet>
        
        <!-- Copy over the files that need unix line endings and also chmod to 755 -->
        <fileSet>
            <directory>src/main/distribution/unix-shell</directory>
            <outputDirectory>/</outputDirectory>
            <lineEnding>unix</lineEnding>
            <fileMode>0755</fileMode>
        </fileSet>

        <!-- Copy over the examples -->
        <fileSet>
            <directory>../examples</directory>
            <filtered>true</filtered>
            <outputDirectory>/examples/</outputDirectory>
            <lineEnding>unix</lineEnding>
            <excludes>
                <exclude>**/itests/**</exclude>
                <exclude>**/target/**</exclude>
            </excludes>
        </fileSet>

        <fileSet>
          <directory>target/components</directory>
          <outputDirectory>deploy</outputDirectory>
        </fileSet>

        <!-- add the examples from SMX3 -->
        <fileSet>
          <directory>target/samples/apache-servicemix-${servicemix3.version}/examples</directory>
          <outputDirectory>examples</outputDirectory>
          <excludes>
            <!-- exclude examples that use jbi:embeddedServicemix --> 
            <exclude>basic/**</exclude>
            <!-- exclude examples that use static configuration -->
            <exclude>cluster/**</exclude>
            <exclude>loan-broker/**</exclude>
            <exclude>file-binding/**</exclude>
            <exclude>rss-binding/**</exclude>
            <exclude>vfs-binding/**</exclude>
            <exclude>wsn-http-binding/**</exclude>
            <exclude>ws-notification/**</exclude>
            <!-- exclude SMX3 itests, as well as the pom.xml that runs them (new pom.xml injected from src/main/distribution/text) -->
            <exclude>bridge/bridge-sa-itest/**</exclude>
            <exclude>bridge/pom.xml</exclude>
          </excludes>
        </fileSet>

    </fileSets>

    <files>
        <file>
            <source>${basedir}/target/maven-shared-archive-resources/META-INF/LICENSE</source>
            <outputDirectory>/</outputDirectory>
            <destName>LICENSE.txt</destName>
            <fileMode>0644</fileMode>
            <lineEnding>unix</lineEnding>
        </file>
        <file>
            <source>${basedir}/target/maven-shared-archive-resources/META-INF/NOTICE</source>
            <outputDirectory>/</outputDirectory>
            <destName>NOTICE.txt</destName>
            <fileMode>0644</fileMode>
            <lineEnding>unix</lineEnding>
        </file>
    </files>

    <dependencySets>

        <!-- Mandatory bundles for everything -->
        <dependencySet>
            <outputDirectory>/system</outputDirectory>
            <outputFileNameMapping>${artifact.artifactId}-${artifact.baseVersion}${dashClassifier?}.${artifact.extension}</outputFileNameMapping>
            <unpack>false</unpack>
            <scope>runtime</scope>
            <includes>
                <!-- NMR / JBI -->
                <include>org.apache.geronimo.specs:geronimo-activation_1.1_spec</include>
                <include>org.apache.servicemix.specs:org.apache.servicemix.specs.stax-api-1.0</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.woodstox</include>
                <include>org.apache.felix:org.apache.felix.prefs</include>
                <include>org.apache.xbean:xbean-classloader</include>
                <include>org.apache.servicemix.document:org.apache.servicemix.document</include>
                <include>org.apache.servicemix.nmr:org.apache.servicemix.nmr.api</include>
                <include>org.apache.servicemix.nmr:org.apache.servicemix.nmr.core</include>
                <include>org.apache.servicemix.nmr:org.apache.servicemix.nmr.spring</include>
                <include>org.apache.servicemix.nmr:org.apache.servicemix.nmr.osgi</include>
                <include>org.apache.servicemix.nmr:org.apache.servicemix.nmr.commands</include>
                <include>org.apache.servicemix.jbi:org.apache.servicemix.jbi.api</include>
                <include>org.apache.servicemix.jbi:org.apache.servicemix.jbi.runtime</include>
                <include>org.apache.servicemix.jbi:org.apache.servicemix.jbi.osgi</include>
                <include>org.apache.servicemix.jbi:org.apache.servicemix.jbi.deployer</include>
                <include>org.apache.servicemix.jbi:org.apache.servicemix.jbi.commands</include>

                <!-- Management -->
                <include>org.apache.servicemix.management:org.apache.servicemix.management.core</include>
                <include>org.apache.servicemix.nmr:org.apache.servicemix.nmr.management</include>
                <include>org.apache.servicemix.jbi:org.apache.servicemix.jbi.management</include>

                <!-- Transaction -->
                <include>org.apache.geronimo.specs:geronimo-jta_1.1_spec</include>
                <include>org.apache.geronimo.specs:geronimo-j2ee-connector_1.5_spec</include>
                <include>org.springframework:spring-tx</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.howl</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.jencks</include>
                <include>org.apache.geronimo.components:geronimo-connector</include>
                <include>org.apache.geronimo.components:geronimo-transaction</include>
                <include>org.apache.servicemix.transaction:org.apache.servicemix.transaction</include>

                <!-- ActiveMQ -->
                <include>org.apache.geronimo.specs:geronimo-jms_1.1_spec</include>
                <include>org.apache.geronimo.specs:geronimo-j2ee-management_1.1_spec</include>
                <include>org.springframework:spring-web</include>
                <include>org.apache.activemq:activemq-core</include>
                <include>org.apache.activemq:activemq-console</include>
                <include>org.apache.activemq:activemq-pool</include>
                <include>commons-pool:commons-pool</include>
                <include>org.apache.xbean:xbean-spring</include>
                <include>org.apache.servicemix.activemq:org.apache.servicemix.activemq.commands</include>

                <!-- WEB / WAR -->
                <include>org.mortbay.jetty:jetty-util</include>
                <include>org.mortbay.jetty:jetty</include>
                <include>org.ops4j.pax.web:pax-web-bundle</include>
                <include>org.ops4j.pax.web:pax-web-jsp</include>
                <include>org.ops4j.pax.web-extender:pax-web-ex-war</include>
                <include>org.ops4j.pax.web-extender:pax-web-ex-whiteboard</include>
                <include>org.ops4j.pax.url:pax-url-war</include>
                <include>org.apache.servicemix.war:org.apache.servicemix.war.deployer</include>

                <!-- CXF -->
                <include>org.apache.geronimo.specs:geronimo-annotation_1.0_spec</include>
                <include>org.apache.geronimo.specs:geronimo-javamail_1.4_spec</include>
                <include>org.apache.servicemix.specs:org.apache.servicemix.specs.saaj-api-1.3</include>
                <include>org.apache.geronimo.specs:geronimo-ws-metadata_2.0_spec</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.asm</include>
                <include>org.apache.cxf:cxf-bundle</include>
                <include>org.apache.servicemix.specs:org.apache.servicemix.specs.jaxb-api-2.1</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.jaxb-impl</include>
                <include>org.apache.servicemix.specs:org.apache.servicemix.specs.jaxws-api-2.1</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.fastinfoset</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.neethi</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.saaj-impl</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.woodstox</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.wsdl4j</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.xmlschema</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.xmlresolver</include>
                <include>org.apache.servicemix.cxf:org.apache.servicemix.cxf.transport.nmr</include>
                <include>org.apache.servicemix.cxf:org.apache.servicemix.cxf.transport.osgi</include>
                <include>org.apache.servicemix.cxf:org.apache.servicemix.cxf.binding.nmr</include>

                <!-- OpenEJB -->
                <!--
				<include>org.apache.xbean:xbean-finder</include>
				<include>org.apache.xbean:xbean-naming</include>
				<include>org.apache.xbean:xbean-reflect</include>
			    <include>org.apache.geronimo.specs:geronimo-ejb_3.0_spec</include>
			    <include>org.apache.geronimo.specs:geronimo-interceptor_3.0_spec</include>
			    <include>org.apache.geronimo.specs:geronimo-jacc_1.1_spec</include>
		        <include>org.apache.geronimo.specs:geronimo-jaxrpc_1.1_spec</include>
		        <include>org.apache.geronimo.specs:geronimo-jpa_3.0_spec</include>
	            <include>org.apache.openejb:openejb-core</include>
	            <include>org.apache.openejb:openejb-cxf</include>
	            <include>org.apache.openejb:openejb-ejbd</include>
	            <include>org.apache.openejb:openejb-http</include>
	            <include>org.apache.openejb:openejb-javaagent</include>
	            <include>org.apache.openejb:openejb-jee</include>
	            <include>org.apache.openejb:openejb-loader</include>
	            <include>org.apache.openejb:openejb-server</include>
	            <include>org.apache.openejb:openejb-webservices</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.commons-cli-1.1</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.openjpa-1.0.1</include>
                <include>org.apache.servicemix.bundles:org.apache.servicemix.bundles.swizzle-stream-1.0.1</include>
                <include>org.apache.servicemix.ejb3:org.apache.servicemix.ejb3.deployer</include>
                -->

            </includes>
        </dependencySet>

    </dependencySets>

</assembly>
